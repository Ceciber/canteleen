<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cashier Interface - Canteleen</title>
  <link rel="stylesheet" href="/css/cashierstyle.css">
</head>
<body>
  <div class="cashier-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-top">
        <button onclick="showSection('guest-selection')"><img src="/images/guesticon.png" alt="Guest" class="sidebar-icon"></button>
        <button onclick="showSection('home')"><img src="/images/homeicon.png" alt="Home" class="sidebar-icon"></button>
        <button onclick="showSection('payment')"><img src="/images/payicon.png" alt="Pay" class="sidebar-icon"></button>
      </div>
      <div class="sidebar-bottom">
        <hr>
        <button onclick="showSection('profile')"><img src="/images/profileicon.png" alt="Profile" class="sidebar-icon"></button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="cashier-main">
      <!-- Guest Selection (Initial View) -->
      <section id="guest-selection" class="active-section">
        <div class="search-bar">
          <input type="text" placeholder="Search guests..." class="search-input">
          <button class="search-btn">
            <img src="/images/searchicon.png" alt="Search" class="search-icon">
          </button>
        </div>
        <div class="guest-options-grid">
          <div class="guest-option" data-discount="0.15">Student</div>
          <div class="guest-option" data-discount="0.10">Teacher</div>
          <div class="guest-option" data-discount="0.05">Staff</div>
          <div class="guest-option" data-discount="0.00">Other</div>
        </div>
      </section>

      <!-- Home Section -->
      <section id="home" class="hidden-section">
        <h2>Home Section</h2>
        <p>Home interface content goes here...</p>
      </section>

      <!-- Payment Section -->
      <section id="payment" class="hidden-section">
        <h2>Payment Section</h2>
        <p>Payment interface content goes here...</p>
      </section>

      <!-- Profile Section -->
      <section id="profile" class="hidden-section">
            <!-- Profile header with welcome message -->
            <div class="profile-header">
            <h2>Welcome, <span id="profile-username">cashier</span></h2> <!-- Username is shown here -->
            </div>
        
            <!-- Horizontal container for profile picture, details, and edit button -->
            <div class="profile-info">
            <!-- 1) Profile picture -->
            <div class="profile-picture">
                <img src="/images/profile.png" alt="Profile Picture">
            </div>
            
            <!-- 2) Profile details -->
            <div class="profile-details">
                <p>Name: <span id="profile-fullname">John Doe</span></p>
                <p>Email: <span id="profile-email">john@example.com</span></p>
                <p>Role: <span id="profile-role">cashier</span></p>
            </div>
            
            <!-- 3) Edit button -->
            <div class="profile-edit-btn">
                <button onclick="toggleProfileEdit()">Edit</button>
            </div>           
            </div>
        
            <!-- Grid for editable fields (3 columns x 2 rows) -->
            <div class="profile-grid">
            <div class="profile-field">
                <label for="edit-fullname">Full Name</label>
                <input type="text" id="edit-fullname" value="John Doe" disabled>
            </div>
            <div class="profile-field">
                <label for="edit-username">Username</label>
                <input type="text" id="edit-username" value="cashier" disabled>
            </div>
            <div class="profile-field">
                <label for="edit-gender">Gender</label>
                <input type="text" id="edit-gender" value="Male" disabled>
            </div>
            <div class="profile-field">
                <label for="edit-country">Country</label>
                <input type="text" id="edit-country" value="USA" disabled>
            </div>
            <div class="profile-field">
                <label for="edit-language">Language</label>
                <input type="text" id="edit-language" value="English" disabled>
            </div>
            <div class="profile-field">
                <label for="edit-email">Email</label>
                <input type="text" id="edit-email" value="john@example.com" disabled>
            </div>
            </div>
        
            <!-- Erase Account and Log out Section -->
            <div class="account-actions">
              <p class="action-link" onclick="eraseAccount()">Erase account</p>
              <p class="action-link" onclick="logout()">Log out</p>
            </div>
            

            
      </section> 
    </main>
  </div>

  <script>
    // Show the selected section and hide others
    function showSection(sectionId) {
      document.querySelectorAll('section').forEach(section => {
        section.style.display = section.id === sectionId ? 'block' : 'none';
      });
    
      if (sectionId === 'profile') {
        loadProfile(); // ðŸ‘ˆ Load from DB when switching to profile
      }
    }
    
  
    // Guest Selection Logic
    document.querySelectorAll('.guest-option').forEach(option => {
      option.addEventListener('click', function() {
        const discount = this.getAttribute('data-discount');
        sessionStorage.setItem('discount', discount);
        showSection('home'); // Switch to home after selecting a guest
      });
    });
  
    // Ensure the cashier starts in the guest selection view
    document.addEventListener("DOMContentLoaded", () => {
      showSection('guest-selection');
    });
  
    // Toggle between edit and save mode for profile editing
    async function toggleProfileEdit() {
      const inputs = document.querySelectorAll('.profile-field input');
      const editBtn = document.querySelector('.profile-edit-btn button');
    
      if (editBtn.textContent === "Edit") {
        inputs.forEach(input => input.disabled = false);
        editBtn.textContent = "Save";
      } else {
        // Collect updated profile info
        const updatedProfile = {
          full_name: document.getElementById('edit-fullname').value,
          gender: document.getElementById('edit-gender').value,
          country: document.getElementById('edit-country').value,
          language: document.getElementById('edit-language').value,
          email: document.getElementById('edit-email').value
        };
    
        try {
          const res = await fetch('/profile/update', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(updatedProfile)
          });
          if (res.ok) {
            document.getElementById('profile-fullname').textContent = updatedProfile.full_name;
            document.getElementById('profile-email').textContent = updatedProfile.email;
            editBtn.textContent = "Edit";
            inputs.forEach(input => input.disabled = true);
          } else {
            alert("Error updating profile");
          }
        } catch (err) {
          console.error("Update failed:", err);
        }
      }
    }
    


    async function loadProfile() {
      try {
        const res = await fetch('/profile');
        const user = await res.json();
    
        document.getElementById('profile-username').textContent = user.username || '';
        document.getElementById('profile-fullname').textContent = user.full_name || '';
        document.getElementById('profile-email').textContent = user.email || '';
        document.getElementById('profile-role').textContent = user.role || '';
    
        document.getElementById('edit-fullname').value = user.full_name || '';
        document.getElementById('edit-username').value = user.username || '';
        document.getElementById('edit-gender').value = user.gender || '';
        document.getElementById('edit-country').value = user.country || '';
        document.getElementById('edit-language').value = user.language || 'English';
        document.getElementById('edit-email').value = user.email || '';
      } catch (err) {
        console.error("Failed to load profile:", err);
      }
    }

    async function eraseAccount() {
      if (confirm("Are you sure you want to erase your account? This cannot be undone.")) {
        try {
          const res = await fetch('/profile/delete', { method: 'POST' });
          if (res.ok) {
            window.location.href = '/';
          } else {
            alert("Error deleting account.");
          }
        } catch (err) {
          console.error(err);
          alert("Error deleting account.");
        }
      }
    }
    
    function logout() {
      window.location.href = '/logout';
    }
    
  </script>  
</body>
</html>